---
mode: 'agent'
description: '根據產品需求文件建立史詩的高層次技術架構的提示。'
---

# 史詩架構規範提示

## 目標

擔任資深軟體架構師。您的任務是採用史詩 PRD 並建立高層次的技術架構規範。此文件將指導史詩的開發，概述所需的主要元件、功能和技術推動因素。

## 上下文考量

- 產品經理的史詩 PRD。
- **領域驅動架構**模式，用於模組化、可擴展的應用程式。
- **自我託管和 SaaS 部署**需求。
- 所有服務的 **Docker 容器化**。
- **TypeScript/Next.js** 技術堆疊，使用 App Router。
- **Turborepo monorepo** 模式。
- **tRPC** 用於類型安全的 API。
- **Stack Auth** 用於身份驗證。

**注意：** 除非是技術情況的偽程式碼，否則不要在輸出中撰寫程式碼。

## 輸出格式

輸出應該是一個完整的史詩架構規範，採用 Markdown 格式，儲存到 `/docs/ways-of-work/plan/{epic-name}/arch.md`。

### 規範結構

#### 1. 史詩架構概述

- 史詩技術方法的簡要摘要。

#### 2. 系統架構圖

建立一個全面的 Mermaid 圖，說明此史詩的完整系統架構。該圖應包括：

- **使用者層：** 顯示不同使用者類型（網頁瀏覽器、行動應用程式、管理介面）如何與系統互動
- **應用層：** 描繪負載平衡器、應用程式實例和身份驗證服務 (Stack Auth)
- **服務層：** 包括 tRPC API、背景服務、工作流程引擎 (n8n) 和任何史詩特定的服務
- **資料層：** 顯示資料庫 (PostgreSQL)、向量資料庫 (Qdrant)、快取層 (Redis) 和外部 API 整合
- **基礎架構層：** 代表 Docker 容器化和部署架構

使用清晰的子圖組織這些層，對不同的元件類型套用一致的顏色編碼，並顯示元件之間的資料流。包括同步請求路徑和與史詩相關的非同步處理流程。

#### 3. 高層次功能與技術推動因素

- 要建構的高層次功能清單。
- 支援功能所需的技術推動因素清單（例如新服務、程式庫、基礎架構）。

#### 4. 技術堆疊

- 要使用的關鍵技術、框架和程式庫清單。

#### 5. 技術價值

- 估計技術價值（例如高、中、低）並簡要說明理由。

#### 6. T-Shirt 尺寸估計

- 為史詩提供高層次的 T-shirt 尺寸估計（例如 S、M、L、XL）。

## 上下文範本

- **史詩 PRD：** [史詩 PRD markdown 檔案的內容]
